name: ci

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch: {}

permissions:
  contents: read

jobs:
  lint-and-guards:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Debug — head commit
        run: |
          echo "GITHUB_SHA=${GITHUB_SHA}"
          git rev-parse HEAD

      - name: Debug — app_admin.py facts
        run: |
          python3 - <<'PY'
import hashlib, pathlib
p = pathlib.Path("app_admin.py")
b = p.read_bytes()
print("sha256:", hashlib.sha256(b).hexdigest())
print("lines :", len(p.read_text(encoding="utf-8").splitlines()))
PY

      - name: Ruff format (diff preview)
        run: ruff format --check --diff .

      - name: Install Ruff (pin exact)
        run: |
          python -m pip install --upgrade pip
          python -m pip install ruff==0.14.2
          ruff --version

      - name: Ruff format (check)
        run: ruff format --check .

      - name: Ruff check (lint)
        run: ruff check --output-format=github .

        
